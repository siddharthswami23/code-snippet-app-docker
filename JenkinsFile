@Library('Shared') _
pipeline {
    agent any

    environment {
        COMPOSE_PROJECT_NAME = 'code-snippet-app'
    }

    stages {
        stage('Hello') {
            steps {
                script {
                    hello()
                }
            }
        }
        stage('DemoCall') {
            steps {
                script {
                    demoCall()
                }
            }
        }
        stage('Clone Repo') {
            steps {
                echo 'ğŸ“¥ Cloning the public GitHub repo'
                script {
                    clone('https://github.com/siddharthswami23/code-snippet-app-docker.git', 'main')
                }
                echo 'âœ… Gi  t repo cloned successfully'
            }
        }

        stage('Build Containers') {
            steps {
                echo 'ğŸ³ Building client and server using Docker Compose'
                script {
                    build - container()
                }
            }
        }

        stage('Run Containers') {
            steps {
                echo 'ğŸš€ Running client and server containers'
                script {
                    run - container()
                }
            }
        }

        stage('Verify Containers') {
            steps {
                echo 'ğŸ” Checking running containers'
                bat 'docker ps'
            }
        }
    }

    post {
        success {
            echo 'âœ… Application deployed successfully at http://localhost:5173'
        }
        failure {
            echo 'âŒ Deployment failed. Check logs.'
        }
    }
}
